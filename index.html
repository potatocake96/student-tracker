<!DOCTYPE html>
<html lang="en-AU">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>trackME — Sign in</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
  /* === trackME minimalist contrast theme + modals === */
  :root{
    --bg:#ffffff;
    --surface:#ffffff;
    --ink:#0a0a0a;
    --muted:#6b7280;
    --line:#e5e7eb;
    --accent:#111111;
    --accent-2:#000000;
    --highlight:#ffd54a;
    --danger:#e11d48;
    --radius:14px;
    --shadow:0 8px 28px rgba(0,0,0,.08);
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
    font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
  a{color:var(--accent);text-decoration:none}
  .card{background:var(--surface);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
  .brand{display:flex;align-items:center;gap:10px;font-weight:700;font-size:18px;letter-spacing:.2px}
  .brand .dot{width:9px;height:9px;border-radius:50%;background:var(--accent)}
  .brand small{font-weight:600;color:var(--muted);font-size:12px}
  .btn,select,input[type="text"],input[type="email"],input[type="password"]{
    border:1px solid var(--line);border-radius:10px;padding:12px 14px;background:#fff;color:var(--ink);
    font:inherit;outline:none;transition:box-shadow .18s ease, transform .14s ease, background-color .18s ease, border-color .18s}
  .btn{cursor:pointer}
  .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  .btn.primary:hover{background:var(--accent-2);transform:translateY(-1px)}
  .btn.ghost{background:#fff;color:var(--ink)}
  .btn.ghost:hover{background:#f7f7f7}
  select:hover,input:hover{background:#fafafa}
  select:focus,input:focus{box-shadow:0 0 0 3px rgba(255,213,74,.45);border-color:var(--accent)}
  h2{font-size:18px;margin:0 0 8px;color:var(--accent)}
  .grid{display:grid;gap:16px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .muted{color:var(--muted)}
  .center{min-height:100svh;display:grid;place-items:center;padding:24px}
  .fade-in{opacity:0;transform:translateY(6px);animation:fade .45s ease forwards}
  @keyframes fade{to{opacity:1;transform:none}}
  @media(max-width:380px){.card{padding:14px}.btn,select,input{padding:10px 12px}}

  /* modal dialogs */
  dialog.modal{
    border:none;border-radius:14px;padding:0;max-width:min(520px,95vw);
    box-shadow:0 12px 40px rgba(0,0,0,.18);
    animation:pop .18s ease-out;
  }
  @keyframes pop{from{opacity:0;transform:translateY(6px) scale(.98)}to{opacity:1;transform:none}}
  dialog::backdrop{background:rgba(0,0,0,.45);backdrop-filter:blur(2px)}
  .modal-header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--line);background:#fff;border-radius:14px 14px 0 0}
  .modal-body{padding:16px;background:#fff;border-radius:0 0 14px 14px}
  .modal-title{font-weight:700;color:var(--accent)}
  .close{border:none;background:transparent;font-size:22px;cursor:pointer;line-height:1}
  .help{font-size:12px;color:var(--muted)}
  .error{color:var(--danger);font-size:13px}
  </style>
</head>
<body>
  <main class="center fade-in">
    <section class="card" style="width:min(520px,95vw)">
      <div class="brand"><span class="dot"></span><span>trackME</span><small>© Simon Dass</small></div>
      <h2>Sign in</h2>
      <div class="grid">
        <input id="email" type="email" placeholder="Email" autocomplete="username email" />
        <input id="pass" type="password" placeholder="Password" autocomplete="current-password" />
        <button id="login" class="btn primary">Sign in</button>
        <div class="row">
          <button id="openCreate" class="btn ghost">Create account</button>
          <button id="openReset" class="btn ghost">Reset password</button>
        </div>
      </div>
      <p id="msg" class="muted" style="margin-top:8px" aria-live="polite"></p>
    </section>
  </main>

  <!-- Create Account Modal -->
  <dialog id="createDlg" class="modal" aria-labelledby="createTitle">
    <div class="modal-header">
      <div class="modal-title" id="createTitle">Create account</div>
      <button class="close" aria-label="Close" data-close="createDlg">×</button>
    </div>
    <div class="modal-body">
      <div class="grid">
        <input id="createEmail" type="email" placeholder="Email" autocomplete="username email" />
        <input id="createPass" type="password" placeholder="Password (min 6 chars)" autocomplete="new-password" />
        <input id="createPass2" type="password" placeholder="Confirm password" autocomplete="new-password" />
        <button id="createSubmit" class="btn primary">Create account</button>
        <div class="help">A verification or reset email may be required depending on your Firebase settings.</div>
        <div id="createMsg" class="error" aria-live="polite"></div>
      </div>
    </div>
  </dialog>

  <!-- Reset Password Modal -->
  <dialog id="resetDlg" class="modal" aria-labelledby="resetTitle">
    <div class="modal-header">
      <div class="modal-title" id="resetTitle">Reset password</div>
      <button class="close" aria-label="Close" data-close="resetDlg">×</button>
    </div>
    <div class="modal-body">
      <div class="grid">
        <input id="resetEmail" type="email" placeholder="Email" autocomplete="username email" />
        <button id="resetSubmit" class="btn primary">Send reset link</button>
        <div class="help">We’ll email a link if the account exists.</div>
        <div id="resetMsg" class="error" aria-live="polite"></div>
      </div>
    </div>
  </dialog>

  <script type="module">
    // Replace with your Firebase project config
    const firebaseConfig = {
      apiKey: "AIzaSyDyVOcyN6GG4Eyk2bglXzZlpRAqE5h_J_8",
    authDomain: "tracker-project-3f3f5.firebaseapp.com",
    projectId: "tracker-project-3f3f5",
      appId: "1:997940286285:web:2e73d6113b74426acf5d04"
  };

    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendPasswordResetEmail } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const $ = (id)=>document.getElementById(id);
    const toast = (t)=>{ $("msg").textContent=t; setTimeout(()=>{ $("msg").textContent="" }, 4200); };

    // Redirect if already signed in
    onAuthStateChanged(auth, (user)=>{ if(user) window.location.href="app.html"; });

    // Sign in
    $("login").onclick = async ()=>{
      try { await signInWithEmailAndPassword(auth, $("email").value, $("pass").value); }
      catch(e){ toast(clean(e.message)); }
    };

    // Open/close modals
    function open(id){ $(id).showModal(); }
    function close(id){ $(id).close(); }
    document.getElementById("openCreate").onclick = ()=> open("createDlg");
    document.getElementById("openReset").onclick = ()=> open("resetDlg");
    document.querySelectorAll(".close").forEach(btn=> btn.addEventListener("click", (e)=> close(e.target.getAttribute("data-close"))));

    // Create account (modal)
    $("createSubmit").onclick = async ()=>{
      $("createMsg").textContent = "";
      const email = $("createEmail").value.trim();
      const p1 = $("createPass").value;
      const p2 = $("createPass2").value;
      if (!email || !p1) return $("createMsg").textContent = "Enter an email and password.";
      if (p1 !== p2) return $("createMsg").textContent = "Passwords do not match.";
      try {
        await createUserWithEmailAndPassword(auth, email, p1);
        close("createDlg"); // onAuthStateChanged will redirect to app.html
      } catch(e){
        $("createMsg").textContent = clean(e.message);
      }
    };

    // Reset password (modal)
    $("resetSubmit").onclick = async ()=>{
      $("resetMsg").textContent = "";
      const email = $("resetEmail").value.trim();
      if (!email) return $("resetMsg").textContent = "Enter your email.";
      try {
        await sendPasswordResetEmail(auth, email);
        $("resetMsg").style.color = "#0b7a0b";
        $("resetMsg").textContent = "Reset link sent (if the account exists).";
      } catch(e){
        $("resetMsg").style.color = "var(--danger)";
        $("resetMsg").textContent = clean(e.message);
      }
    };

    function clean(msg){
      // Shorten Firebase error messages a bit
      return msg?.replace(/^Firebase:\s*/,'').replace(/\(auth\/[\w-]+\)/,'').trim();
    }

    // Close on backdrop click
    ["createDlg","resetDlg"].forEach(id=>{
      $(id).addEventListener("click", (ev)=>{
        const rect = ev.target.getBoundingClientRect();
        const inDialog = ev.clientY >= rect.top && ev.clientY <= rect.bottom && ev.clientX >= rect.left && ev.clientX <= rect.right;
        if (!inDialog) close(id);
      });
    });
  </script>
</body>
</html>
